<!doctype html> 
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <title>SETTER</title>
        <link rel="stylesheet" href="stylesheets/app.css" />
        <script src="bower_components/modernizr/modernizr.js"></script>

        <!--Google Web Font
        ================================================== -->
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,700' rel='stylesheet' type='text/css'>


        <!--Google Jquery API
        ================================================== -->    
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

        <!-- Mobile Specific Metas
        ================================================== -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <!-- Favicons
        ================================================== -->
  <!--       <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"> -->
    </head>

    <body>
        
                <!-- Backbone script 
        ================================================== -->
        <script src="js/vendor/underscore.js"></script>
        <script src="js/vendor/backbone.js"></script>
        <script src="js/vendor/dependencies.js"></script>
        <script src="js/vendor/pizza.js"></script>
        <script src="js/app.js"></script>
        <script src="bower_components/foundation/js/foundation.min.js"></script>
        <script type="text/javascript">
            //Creates a gloabl object called templateLoader with a single method "loadExtTemplate"
            var templateLoader = (function($,host){
                //Loads external templates from path and injects in to page DOM
                return{
                    //Method: loadExtTemplate
                    //Params: (string) path: the relative path to a file that contains template definition(s)
                    loadExtTemplate: function(path){
                        //Use jQuery Ajax to fetch the template file
                        var tmplLoader = $.get(path)
                            .success(function(result){
                                //On success, Add templates to DOM (assumes file only has template definitions)
                                $("body").append(result);
                            })
                            .error(function(result){
                                alert("Error Loading Templates -- TODO: Better Error Handling");
                            })

                        tmplLoader.complete(function(){
                            //Publish an event that indicates when a template is done loading
                            $(host).trigger("TEMPLATE_LOADED", [path]);
                        });
                    }
                };
            })(jQuery, document);

            var templateFolder = "templates/";
            var templatesLoaded = 0;
            var templatesToLoad = [
                "navigation.tmpl.html",
                "gym--dashboard.tmpl.html",
                "gym--insights.tmpl.html",
                "gym--managewalls.tmpl.html",
                "gym--setters.tmpl.html",
                "gym--signup.tmpl.html",
                "account--settings.tmpl.html",
                "gym--managewall.tmpl.html",
                "gym--manageroute.tmpl.html",
                "gym--publicProfile.tmpl.html",
                "user--profile.tmpl.html",
                "user--accountsettings.tmpl.html",
                "user--gymsearch.tmpl.html",
                "user--sentroutes.tmpl.html"
            ];
                        
            for (var i = 0; i < templatesToLoad.length; i++){
                var templateToLoad = templatesToLoad[i];
                templateLoader.loadExtTemplate(templateFolder + templateToLoad);
            }

            //Subscribe to event triggered when templates loaded
            //(Don't load use templates before they are available)
            $(document).bind("TEMPLATE_LOADED", function(e, path) {
                templatesLoaded++;

                if (templatesLoaded == templatesToLoad.length){
                    console.log("all templates loaded");
                    $("body").prepend($("#template_navigation").html());
                    setupNavigation();
                    setupApp();
                }                
            });

            // $(window).load(function(){
            //     Pizza.init();
            // });

            var setupNavigation = function(){

                //Account Login Dropdown Button Code 
                $('[data-action="open-account-dropDown"]').click(function(e){
                    var leftOffset = $(e.target).offset().left;
                    var $dropDown = $('[data-ui-component="account-dropDown"]');

                    if (! $dropDown.hasClass('visible') 
                        && ! $dropDown.hasClass('visible--mobile') 
                        && $dropDown.css("maxWidth") == "300px" ){
                        $dropDown.addClass('visible').css({left: leftOffset-260});
                    }else if ($dropDown.css("maxWidth") == "600px" 
                        && ! $dropDown.hasClass('visible--mobile')){
                        $dropDown.addClass('visible--mobile').css({ left: 10});
                    }else{
                        $dropDown.removeClass('visible--mobile').css({ left: -9999 });
                        $dropDown.removeClass('visible').css({ left: -9999 });
                    }
                });

                //Account Navigation Slider Code
               $("[data-action='open-nav-account']" || "[data-action='open-nav-account'] a").on('click',  function() {
                    var $mainSection = $('[data-ui-component="main-wrap"]');
                     if(!$mainSection.hasClass('nav-account--toggle')) {
                        console.log("adding class of toggle");
                        $mainSection.addClass('nav-account--toggle');
                    } else {
                        $mainSection.removeClass('nav-account--toggle');
                    }
                });

                //Code for closing Account Nav and Drop Down when clicking outside//
                $(document).click(function(event) {

                    var $mainSection = $('[data-ui-component="main-wrap"]'),
                        $dropDown = $('[data-ui-component="account-dropDown"]');

                    //Closes Account Settings dropDown when clicking child links and 
                    //outside of dropDown 
                    if ($dropDown.hasClass('visible') || $dropDown.hasClass('visible--mobile') ) {
                        if($(event.target).is('a')) {
                            $dropDown.removeClass('visible--mobile').css({ left: -9999 });
                            $dropDown.removeClass('visible').css({ left: -9999 });
                        }
                        else if(!$(event.target).parents('[data-action="open-account-dropDown"]')[0]) {
                            $dropDown.removeClass('visible--mobile').css({ left: -9999 });
                            $dropDown.removeClass('visible').css({ left: -9999 });
                        }
                    }

                    //Closes Account Nav When Cliking Outside or //links
                    if($mainSection.hasClass('nav-account--toggle')) {
                        if($(event.target).parents('.nav-primary').length === 0 || $(event.target).is('a'))
                         {  
                            $mainSection.removeClass('nav-account--toggle');
                        }
                    }  
                });
            }
        </script>
    </body>
</html>